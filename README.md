# A Python `plotnine` book built with Rmarkdown

## Motivation

Found this interesting [article](https://datascienceworkshops.com/blog/plotnine-grammar-of-graphics-for-python/) by [Jeroen Janssens](https://github.com/python-oilgains/r4ds-python-plotnine/commits?author=jeroenjanssens) on applying the [Grammar of Graphics](https://www.springer.com/gp/book/9780387245447) introduced to data science by [#rstats](https://www.linkedin.com/feed/hashtag/?keywords=rstats&highlightedUpdateUrns=urn%3Ali%3Aactivity%3A6727441978495180800) [ggplot2](https://ggplot2.tidyverse.org/). The amazing thing is that the article has been totally  computed with Python as the coding engine, while the text is in [Rmarkdown](https://rmarkdown.rstudio.com/articles_intro.html). The plots have been generated by the Python package [plotnine](https://plotnine.readthedocs.io/en/stable/), practically duplicating what R `ggplot2` does!

I liked the article so much that I decided to make it a "minimal book" with R [bookdown](https://bookdown.org/), maintaining the Python computations. Rmarkdown is the extended and  super-powered version of [Markdown](https://www.markdownguide.org/getting-started/), which uses some text symbols - such  as `#`, `*`, `_`, `[` `]`, and others to add formatting to the document. Markdown and Rmarkdown documents are fully reproducible and can have version control with Git, since they are full text.

What I am seeing, more and more lately, are Python analysis being written in Rmarkdown instead of Jupyter notebooks. This will bring a significant  change in data science, machine learning, and reproducibility due to the flexible nature of Rmarkdown. And of course, mingling tightly Python  and R, through a common document, as both can share data objects.

## Structure

1. This book is entirely written in `python-rmarkdown`, which esentially means the author wrote it in **Rmarkdown** with most of the code chunks using **Python** as the [knitr]() engine.

2. This book uses a virtual environment created with the **GNU Python** package `virtualenv`. Each of the chapters of the book loads the Python environment `pyenv` before running the Python code in the code blocks. So, it is important that the `pyenv` environment is installed before you start building (knitting) the book.

3. The environment `pyenv` is not available beforehand. You have to install it yourself. You can do it manually, or you could use the `Makefile` rules also available in this repository. The rule to create the Python environment is `make create_pyenv`.

4. The recipe (list of packages and Python version) is provided by the file `requirements.txt`. The rule `make create_pyenv` will read the recipe and build the environment `pyenv` accordingly.

5. The settings for building this [bookdown]() book are located in the files: `_bookdown.yml`, `_output.yml`, and `index.Rmd`.

6. The environment `pyenv` comes with `Jupyter` installed, and will open the default `ipynb` notebook when the installation of the environment is completed.

7. The main packages behind `python-rmarkdown` are: `reticulate`, `bookdown`, `knitr`, `rmarkdown`, and others. At least you have to have an R installation with these packages installed.

8. Every chapter has a time updating stamp that will inform the user when was the last time that chapter was updated. The timestamp is located right after the main chapter title.

9. Each of the chapters is formatted in the `Rmd` file itself via its own `knitr::opts_chunk$set()` function. This can, of course, be improved by moving the block to its own R script, which make sufficent to load the script with `source("R/script.R")` instead of having to copy-pasted on each of the chapter files.



## Minimal Book of `plotnine`

The goal of `plotnine-book` is to show a practical application of a book where all the computations and plots have been generated using **Python**. **Rmarkdown** is the format being used in the writing of each of the chapters instead of the classic **Jupyter** notebooks.

**Rmarkdown** opens infinite creation possibilities to scientists, engineers and analysts for the production of documents, reports, analysis, tutorials, manuals, papers, thesis, presentations, slides, or even websites or blogs. The advantages of writing your documents in Rmarkdown is that your document and analysis are:

-   Documents are totally reproducible and able to be put under version control such as Git, GitHub, or other cloud repositories

-   Documents are fully written in text which can be opened at any time with a simple text editor

-   Multiple coding languages can be embedded in a single document

-   Python and R can mutually interchange values of objects or variables in the same Rmarkdown document

-   Rmarkdown documents can be built to be HTML books, Git books, PDF books, and few other output formats

## A book on Python computed with Python 

This book uses **Python** and Python packages for the generation of tables, plots and figures. R is only used to do the book compilation via the package `bookdown`. In this particular book, we used the following Python packages:

-   plotnine

-   matplotlib

-   numpy

-   pandas

-   warnings


## Pre-requisites

1.  A Python virtual environment with GNU Python and `virtualenv`. We will not use `conda` this time.
2.  An installation of R. I used R-3.6.3 to build this book. 
3.  A computer able to run GNU `make` to process the `Makefile` rules for this book.

## Building the book

### Install the Python environment
This `Makefile` rule will automatically create the Python environment for you:

    make create_env

## Build the gitbook

Once R and Python are installed and updated, we are ready to build the book. From a terminal, run:

    make gitbook

If the book builds successfully, it should open your browser with the main page of the book. This is all handled by `make` and the commands in `Makefile`.

## Push the book to GitHub

    make push


## Optional after building the book

If you make changes to the Rmarkdown documents, you may want to tidy up or totally clean from auxiliary and files that were generated during the knitting process. The are two rules in the `Makefile`: `tidy` and `clean `.

### Tidy up the folder

This deletes the auxiliary files that were created during the book building process.

    make tidy

### Clean up the folder

Does `make tidy` plus deletes the publication folder, to start over fresh.

    make clean


### Optional: Update current R installation with a recipe

Since we will be using some R packages to build the Rmarkdown book, among them `knitr`, first, we need to update our R installation. There is a rule in Makefile that takes care of that. Run it from the terminal with:

```
make renv/library
```

This will update the packages according to the recipe in the file `renv.lock`.